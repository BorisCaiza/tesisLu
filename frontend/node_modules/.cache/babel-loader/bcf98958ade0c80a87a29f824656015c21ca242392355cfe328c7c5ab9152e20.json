{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Boris\\\\Desktop\\\\Final WorkOut\\\\tesislu\\\\frontend\\\\src\\\\Context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport api from '../api/api';\nimport Swal from 'sweetalert2';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nconst getUserFromStorage = () => {\n  const user = localStorage.getItem('user');\n  return user ? JSON.parse(user) : null;\n};\nconst setUserToStorage = user => {\n  localStorage.setItem('user', JSON.stringify(user));\n};\nconst AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(getUserFromStorage());\n  const [error, setError] = useState('');\n  const navigator = useNavigate();\n  const getUser = async () => {\n    await api.get('/user/' + user.id).then(res => {\n      if (res.status === 200) {\n        return res.data.user;\n      }\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n  const refreshToken = async () => {\n    try {\n      const response = await api.post('/user/token', {\n        token: localStorage.getItem('refreshToken')\n      });\n      localStorage.removeItem(\"user-token\");\n      localStorage.removeItem(\"refreshToken\");\n      const {\n        token,\n        refreshToken\n      } = response.data;\n      localStorage.setItem('user-token', token);\n      localStorage.setItem(\"refreshToken\", refreshToken);\n      const userNew = await getUser();\n      setUser({\n        ...user,\n        permisos: user.permisos,\n        token: token,\n        refreshToken: refreshToken\n      });\n      setUserToStorage({\n        ...user,\n        token: token,\n        permisos: userNew === null || userNew === void 0 ? void 0 : userNew.permisos,\n        refreshToken: refreshToken\n      });\n    } catch (error) {\n      if (error.response && error.response.status === 403) {\n        logout();\n      }\n      console.log(error);\n    }\n  };\n  useEffect(() => {\n    if (user && user.refreshToken) {\n      const refreshTokenInterval = setInterval(refreshToken, 3 * 60 * 1000); // Actualizar el token cada 15 minutos\n      return () => {\n        clearInterval(refreshTokenInterval);\n      };\n    }\n  }, [user]);\n  useEffect(() => {\n    setUserToStorage(user);\n  }, [user]);\n  const login = async values => {\n    try {\n      const response = await api.post('/user/login', values);\n      console.log(\"responmse\", response.data);\n      if (response.status === 200) {\n        setUser(response.data);\n        setUserToStorage(response.data);\n        localStorage.setItem('user-token', response.data.token);\n        localStorage.setItem(\"refreshToken\", response.data.refreshToken);\n        localStorage.setItem(\"role\", response.data.role);\n        Swal.fire({\n          icon: 'success',\n          iconHtml: '<img src=\"https://www.easy-gst.in/wp-content/uploads/2017/07/success-icon-10.png\" alt=\"Icono personalizado\" width=\"98\">',\n          title: \"Bienvenido!!!\",\n          showConfirmButton: false,\n          timer: 1500\n        });\n        navigator(\"/local\");\n      } else {}\n    } catch (error) {\n      console.log(\"error\", error);\n      if (error.response && error.response.data && error.response.data.message) {\n        Swal.fire({\n          icon: 'error',\n          iconHtml: '<img src=\"https://cdn.icon-icons.com/icons2/317/PNG/512/sign-error-icon_34362.png\" width=\"125\">',\n          title: \"Credenciales Invalidas!!\",\n          showConfirmButton: false,\n          timer: 1500\n        });\n        setError(error.response.data.message);\n      } else {\n        Swal.fire({\n          icon: 'error',\n          iconHtml: '<img src=\"https://cdn.icon-icons.com/icons2/317/PNG/512/sign-error-icon_34362.png\" width=\"125\">',\n          title: \"Credenciales Invalidas!!\",\n          showConfirmButton: false,\n          timer: 1500\n        });\n        setError('Ocurri贸 un error al iniciar sesi贸n.');\n      }\n    }\n  };\n  const logout = async () => {\n    try {\n      const res = await api.post('/user/logout', {\n        refreshToken: user.refreshToken\n      });\n      console.log(res);\n    } catch (error) {\n      console.log(error);\n    }\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"user-token\");\n    localStorage.removeItem(\"refreshToken\");\n    localStorage.removeItem(\"role\");\n    setUser(null);\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      error,\n      login,\n      logout,\n      getUser\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 147,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthProvider, \"nGIaIkbsp3lIXA3Ec9+0deS3B+o=\", false, function () {\n  return [useNavigate];\n});\n_c = AuthProvider;\nexport { AuthContext, AuthProvider };\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useState","useNavigate","api","Swal","jsxDEV","_jsxDEV","AuthContext","getUserFromStorage","user","localStorage","getItem","JSON","parse","setUserToStorage","setItem","stringify","AuthProvider","children","_s","setUser","error","setError","navigator","getUser","get","id","then","res","status","data","catch","console","log","refreshToken","response","post","token","removeItem","userNew","permisos","logout","refreshTokenInterval","setInterval","clearInterval","login","values","role","fire","icon","iconHtml","title","showConfirmButton","timer","message","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Boris/Desktop/Final WorkOut/tesislu/frontend/src/Context/AuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport api from '../api/api';\r\nimport Swal from 'sweetalert2';\r\n\r\nconst AuthContext = createContext();\r\n\r\nconst getUserFromStorage = () => {\r\n    const user = localStorage.getItem('user');\r\n    return user ? JSON.parse(user) : null;\r\n};\r\n\r\nconst setUserToStorage = (user) => {\r\n    localStorage.setItem('user', JSON.stringify(user));\r\n};\r\n\r\n\r\n\r\nconst AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(getUserFromStorage());\r\n    const [error, setError] = useState('');\r\n    const navigator = useNavigate();\r\n\r\n    const getUser = async () => {\r\n\r\n        await api.get('/user/' + user.id).then(res => {\r\n            if (res.status === 200) {\r\n                return res.data.user;\r\n            }\r\n        }).catch(error => {\r\n            console.log(error);\r\n        })\r\n    }\r\n\r\n    const refreshToken = async () => {\r\n        try {\r\n            const response = await api.post('/user/token', {\r\n                token: localStorage.getItem('refreshToken'),\r\n            });\r\n            localStorage.removeItem(\"user-token\");\r\n            localStorage.removeItem(\"refreshToken\");\r\n\r\n            const { token, refreshToken } = response.data;\r\n\r\n            localStorage.setItem('user-token', token);\r\n            localStorage.setItem(\"refreshToken\", refreshToken)\r\n\r\n            const userNew = await getUser();\r\n\r\n            setUser({\r\n                ...user,\r\n                permisos: user.permisos,\r\n                token: token,\r\n                refreshToken: refreshToken,\r\n            });\r\n\r\n            setUserToStorage({\r\n                ...user,\r\n                token: token,\r\n                permisos: userNew?.permisos,\r\n                refreshToken: refreshToken,\r\n            });\r\n        } catch (error) {\r\n            if (error.response && error.response.status === 403) {\r\n                logout();\r\n            }\r\n            console.log(error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (user && user.refreshToken) {\r\n            const refreshTokenInterval = setInterval(refreshToken, 3 * 60 * 1000); // Actualizar el token cada 15 minutos\r\n            return () => {\r\n                clearInterval(refreshTokenInterval);\r\n            };\r\n        }\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        setUserToStorage(user);\r\n    }, [user]);\r\n\r\n    const login = async (values) => {\r\n        try {\r\n            const response = await api.post('/user/login', values);\r\n            console.log(\"responmse\", response.data)\r\n            if (response.status === 200) {\r\n                setUser(response.data);\r\n                setUserToStorage(response.data);\r\n                localStorage.setItem('user-token', response.data.token);\r\n                localStorage.setItem(\"refreshToken\", response.data.refreshToken)\r\n                localStorage.setItem(\"role\", response.data.role)\r\n                Swal.fire({\r\n                    icon: 'success',\r\n                    iconHtml: '<img src=\"https://www.easy-gst.in/wp-content/uploads/2017/07/success-icon-10.png\" alt=\"Icono personalizado\" width=\"98\">',\r\n                    title: \"Bienvenido!!!\",\r\n                    showConfirmButton: false,\r\n                    timer: 1500\r\n                })\r\n\r\n                navigator(\"/local\")\r\n            } else {\r\n\r\n            }\r\n        } catch (error) {\r\n            console.log(\"error\", error)\r\n            if (error.response && error.response.data && error.response.data.message) {\r\n                Swal.fire({\r\n                    icon: 'error',\r\n                    iconHtml: '<img src=\"https://cdn.icon-icons.com/icons2/317/PNG/512/sign-error-icon_34362.png\" width=\"125\">',\r\n                    title: \"Credenciales Invalidas!!\",\r\n                    showConfirmButton: false,\r\n                    timer: 1500\r\n                })\r\n\r\n\r\n                setError(error.response.data.message);\r\n            } else {\r\n                Swal.fire({\r\n                    icon: 'error',\r\n                    iconHtml: '<img src=\"https://cdn.icon-icons.com/icons2/317/PNG/512/sign-error-icon_34362.png\" width=\"125\">',\r\n                    title: \"Credenciales Invalidas!!\",\r\n                    showConfirmButton: false,\r\n                    timer: 1500\r\n                })\r\n                setError('Ocurri贸 un error al iniciar sesi贸n.');\r\n            }\r\n        }\r\n    };\r\n\r\n    const logout = async () => {\r\n        try {\r\n            const res = await api.post('/user/logout', { refreshToken: user.refreshToken });\r\n            console.log(res);\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n        localStorage.removeItem(\"user\");\r\n        localStorage.removeItem(\"user-token\");\r\n        localStorage.removeItem(\"refreshToken\");\r\n        localStorage.removeItem(\"role\");\r\n        setUser(null);\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider\r\n            value={{\r\n                user,\r\n                error,\r\n                login,\r\n                logout,\r\n                getUser\r\n            }}\r\n        >\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport { AuthContext, AuthProvider };\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}